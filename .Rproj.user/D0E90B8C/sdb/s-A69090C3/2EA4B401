{
    "collab_server" : "",
    "contents" : "#----------------------------------------------------------------------------------\n# Dorleta Garcia\n# 2018/09/19\n#\n# Join results from the cluster simulation\n#----------------------------------------------------------------------------------\n\nsetwd('c:/use/OneDrive - Azti/BoB/01_MultiStockHCR/output/')\n\nload('./cluster/res_sums_1.RData')\n\niters <- (1:500)[1:25]\n\nNiter <- length(iters)\n\nFLT <- data.frame(matrix(NA, nrow = dim(fltQ)[1]*Niter, ncol = dim(fltQ)[2], \n                         dimnames = list(NULL, names(fltQ))))\n\nBIO <- data.frame(matrix(NA, nrow = dim(bioQ)[1]*Niter, ncol = dim(bioQ)[2], \n                         dimnames = list(NULL, names(bioQ))))\n\nFLTSTK <- data.frame(matrix(NA, nrow = dim(fltStkQ)[1]*Niter, ncol = dim(fltStkQ)[2], \n                             dimnames = list(NULL, names(fltStkQ))))\n\nMTSTK <- data.frame(matrix(NA, nrow = dim(mtStkQ)[1]*Niter, ncol = dim(mtStkQ)[2], \n                             dimnames = list(NULL, names(mtStkQ))))\n MT <- data.frame(matrix(NA, nrow = dim(mtQ)[1]*Niter, ncol = dim(mtQ)[2], \n                            dimnames = list(NULL, names(mtQ))))\n\nADV <- data.frame(matrix(NA, nrow = dim(advQ)[1]*Niter, ncol = dim(advQ)[2], \n                            dimnames = list(NULL, names(advQ))))\n\nKe <- Kb <- Ka <- Km <- Kms <- Kfs <-  1\n\nfor(j in iters){\n\n    load(paste('cluster/res_sums_',j, '.RData', sep =\"\"))\n  \n    \n    fltQ$scenario <- as.character(fltQ$scenario)\n    advQ$scenario <- as.character(advQ$scenario)\n    bioQ$scenario <- as.character(bioQ$scenario)\n    mtQ$scenario <- as.character(mtQ$scenario)\n    fltStkQ$scenario <- as.character(fltStkQ$scenario)\n    mtStkQ$scenario <- as.character(mtStkQ$scenario)\n    \n    fltQ$year       <- as.numeric(as.character(fltQ$year))\n    fltQ$fleet      <- as.character(fltQ$fleet)\n    fltStkQ$fleet   <- as.character(fltStkQ$fleet)\n    fltStkQ$year    <- as.numeric(as.character(fltStkQ$year))\n    fltStkQ$stock   <- as.character(fltStkQ$stock)\n    \n    FLT[Ke:(Ke+dim(fltQ)[1]-1),1:dim(fltQ)[2]] <- fltQ\n    FLT[Ke:(Ke+dim(fltQ)[1]-1),'iter']        <- j\n    \n    BIO[Kb:(Kb+dim(bioQ)[1]-1),1:dim(bioQ)[2]] <- bioQ\n    BIO[Kb:(Kb+dim(bioQ)[1]-1),'iter']        <- j\n    \n    FLTSTK[Kfs:(Kfs+dim(fltStkQ)[1]-1),1:dim(fltStkQ)[2]] <- fltStkQ\n    FLTSTK[Kfs:(Kfs+dim(fltStkQ)[1]-1),'iter']           <- j  \n    \n    ADV[Ka:(Ka+dim(advQ)[1]-1),1:dim(advQ)[2]] <- advQ\n    ADV[Ka:(Ka+dim(advQ)[1]-1),'iter']        <- j   \n    \n    MT[Km:(Km+dim(mtQ)[1]-1),1:dim(mtQ)[2]] <- mtQ\n    MT[Km:(Km+dim(mtQ)[1]-1),'iter']        <- j\n     \n    MTSTK[Kms:(Kms+dim(mtStkQ)[1]-1),1:dim(mtStkQ)[2]] <- mtStkQ\n     MTSTK[Kms:(Kms+dim(mtStkQ)[1]-1),'iter']           <- j  \n    \n    Ke <- Ke + dim(fltQ)[1]\n    Kb <- Kb + dim(bioQ)[1]\n    Ka <- Ka + dim(advQ)[1]\n    Km  <- Km + dim(mtQ)[1]\n    Kms <- Kms + dim(mtStkQ)[1]\n    Kfs <- Kfs + dim(fltStkQ)[1]\n    \n    print(j)\n}\n\nsave(ADV, FLT, BIO, FLTSTK, MT, MTSTK, file =  './res_sums_25Iter.RData')\n\n\nBIO <- BIO[,c(1:5)]\nnames(BIO)[5] <- 'value'\n\nFLT <- FLT[,c(1:5)]\nnames(FLT)[5] <- 'value'\n\nFLTSTK <- FLTSTK[,c(1:6)]\nnames(FLTSTK)[6] <- 'value'\n\nMT <- MT[,c(1:6)]\nnames(MT)[6] <- 'value'\n\nMTSTK <- MTSTK[,c(1:7)]\nnames(MTSTK)[7] <- 'value'\n\nADV <- ADV[,c(1:5)]\nnames(ADV)[5] <- 'value'\n\nbioQ <- bioSumQ(BIO)\nfltQ <- fltSumQ(FLT)\nfltStkQ <- fltStkSumQ(FLTSTK)\nmtQ <- mtSumQ(MT)\nmtStkQ <- mtStkSumQ(MTSTK)\nadvQ <- advSumQ(ADV)\n\n\nbb <- subset(BIO, indicator == 'ssb')\nnames(bb)[5] <- 'ssb'\n\nff <- subset(FLT, indicator == 'grossValue')\nnames(ff)[5] <- 'grossSurplus'\n\nrisk <- riskSumFromDF(bb, ff, Bpa = unlist(sapply(advice.ctrl.msy, function(x) c(x$ref.pts['Blim',1])))*1.4, \n              Blim = unlist(sapply(advice.ctrl.msy, function(x) c(x$ref.pts['Blim',1]))), \n              Prflim = sapply(fleets, function(x) 0), scenario = unique(bioQ$scenario))\n\nsave(risk, bioQ, fltQ,  fltStkQ, mtQ, mtStkQ, advQ, file = './res_shiny.RData' )\n",
    "created" : 1542120485641.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2479016987",
    "id" : "2EA4B401",
    "lastKnownWriteTime" : 1542144441,
    "last_content_update" : 1542144441,
    "path" : "~/OneDrive - AZTI/BoB/01_MultiStockHCR/04_Bob_JoinResults_TEST.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 14,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}