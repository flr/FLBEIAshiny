{
    "collab_server" : "",
    "contents" : "#-----------------------------------------------------------------------------\n#  Simulations using different quota-shares:\n#   * The observed one.\n#   * The real one, taken from the quota.shares by area and country and using\n#       the catch by fleet/country/Area to separate it by fleet.\n#   * The optimum quota.shares for basque trawl fleet and the same for the others\n#\n# Dorleta Garcia\n# 2018/11/30\n#-----------------------------------------------------------------------------\nlibrary(FLBEIA)\nlibrary(FLBEIAShiny)\n\nsetwd(\"C:/use/OneDrive - AZTI/BoB/03_Economics\")\n\nload('./data/FLR_Objs_Eco.RData')\nload('./data/ctrls.RData')\n#-------------------------------------------------------------\n# Observed quota-shares \n#-------------------------------------------------------------\nmax <- FLBEIA(biols = biols, SRs = SRs, BDs = NULL, fleets = fleets, covars = list(rec = SRs$HKE@rec),\n              indices = NULL, advice = advice, main.ctrl = main.ctrl, biols.ctrl = biols.ctrl, fleets.ctrl = fleets.ctrl.max, \n              covars.ctrl = NULL, obs.ctrl = obs.ctrl, assess.ctrl = assess.ctrl, advice.ctrl = advice.ctrl.msy) \n\nmin <- FLBEIA(biols = biols, SRs = SRs, BDs = NULL, fleets = fleets, covars = list(rec = SRs$HKE@rec),\n              indices = NULL, advice = advice, main.ctrl = main.ctrl, biols.ctrl = biols.ctrl, fleets.ctrl = fleets.ctrl.min, \n              covars.ctrl = NULL, obs.ctrl = obs.ctrl, assess.ctrl = assess.ctrl, advice.ctrl = advice.ctrl.msy)\n\npre <- FLBEIA(biols = biols, SRs = SRs, BDs = NULL, fleets = fleets, covars = list(rec = SRs$HKE@rec),\n              indices = NULL, advice = advice, main.ctrl = main.ctrl, biols.ctrl = biols.ctrl, fleets.ctrl = fleets.ctrl.prev, \n              covars.ctrl = NULL, obs.ctrl = obs.ctrl, assess.ctrl = assess.ctrl, advice.ctrl = advice.ctrl.msy) \n\nobs.hke <- quantSums(catchWStock.f(max$fleets$OT8_SP, 'HKE'))/max$advice$TAC$HKE\nobs.meg <- quantSums(catchWStock.f(max$fleets$OT8_SP, 'MEG'))/max$advice$TAC$MEG\nobs.mon <- quantSums(catchWStock.f(max$fleets$OT8_SP, 'MON'))/max$advice$TAC$MON\nobs.ank <- quantSums(catchWStock.f(max$fleets$OT8_SP, 'ANK'))/max$advice$TAC$ANK\n\nrat.qs <- data.frame(rat.qs = c(obs.hke[,ac(2018:2025)]/advice$quota.share$HKE['OT8_SP',ac(2018:2025)],\n                                obs.meg[,ac(2018:2025)]/advice$quota.share$MEG['OT8_SP', ac(2018:2025)],\n                                obs.mon[,ac(2018:2025)]/advice$quota.share$MON['OT8_SP', ac(2018:2025)],\n                                obs.ank[,ac(2018:2025)]/advice$quota.share$ANK['OT8_SP', ac(2018:2025)]),\n                     stock = rep(c('HKE', 'MEG', 'MON', 'ANK'), each = 8), year = rep(2018:2025, 4))\n\n#ggplot(rat.qs, aes(year, rat.qs, group = stock, color = stock)) + geom_line(lwd = 1.5)\n\n\nadvice.opt <- advice\nadvice.opt$quota.share$ANK['OT8_SP',ac(2018:2025)] <- mean(obs.ank[,ac(2021:2025)])\nadvice.opt$quota.share$MON['OT8_SP',ac(2018:2025)] <- mean(obs.mon[,ac(2021:2025)])\nadvice.opt$quota.share$MEG['OT8_SP',ac(2018:2025)] <- mean(obs.meg[,ac(2021:2025)])\n\nadvice.opt$quota.share <- lapply(advice.opt$quota.share, function(x) x%/%quantSums(x))\n\n#-------------------------------------------------------------\n# Theoretical quota-shares\n#-------------------------------------------------------------\nadvice.the$quota.share$ANK['MIS_SP', ac(2018:2025)] <- 0\nfleets[['MIS_SP']]@metiers[[1]]@catches[['ANK']]@catch.q[] <- 0\nfleets[['MIS_SP']]@metiers[[1]]@catches[['MEG']]@catch.q[] <- 0\nfleets[['MIS_SP']]@metiers[[1]]@catches[['MON']]@catch.q[] <- 0\nfleets[['MIS_SP']]@metiers[[1]]@catches[['HKE']]@catch.q[] <- 0\n\nmax.the <- FLBEIA(biols = biols, SRs = SRs, BDs = NULL, fleets = fleets, covars = list(rec = SRs$HKE@rec),\n                  indices = NULL, advice = advice.the, main.ctrl = main.ctrl, biols.ctrl = biols.ctrl, fleets.ctrl = fleets.ctrl.max, \n                  covars.ctrl = NULL, obs.ctrl = obs.ctrl, assess.ctrl = assess.ctrl, advice.ctrl = advice.ctrl.msy) \n\nmin.the <- FLBEIA(biols = biols, SRs = SRs, BDs = NULL, fleets = fleets, covars = list(rec = SRs$HKE@rec),\n                  indices = NULL, advice = advice.the, main.ctrl = main.ctrl, biols.ctrl = biols.ctrl, fleets.ctrl = fleets.ctrl.min, \n                  covars.ctrl = NULL, obs.ctrl = obs.ctrl, assess.ctrl = assess.ctrl, advice.ctrl = advice.ctrl.msy)\n\npre.the <- FLBEIA(biols = biols, SRs = SRs, BDs = NULL, fleets = fleets, covars = list(rec = SRs$HKE@rec),\n                  indices = NULL, advice = advice.the, main.ctrl = main.ctrl, biols.ctrl = biols.ctrl, fleets.ctrl = fleets.ctrl.prev, \n                  covars.ctrl = NULL, obs.ctrl = obs.ctrl, assess.ctrl = assess.ctrl, advice.ctrl = advice.ctrl.msy) \n\n\n\n#-------------------------------------------------------------\n# Optimum quota-shares\n#-------------------------------------------------------------\n\nmax.opt <- FLBEIA(biols = biols, SRs = SRs, BDs = NULL, fleets = fleets, covars = list(rec = SRs$HKE@rec),\n                  indices = NULL, advice = advice.opt, main.ctrl = main.ctrl, biols.ctrl = biols.ctrl, fleets.ctrl = fleets.ctrl.max, \n                  covars.ctrl = NULL, obs.ctrl = obs.ctrl, assess.ctrl = assess.ctrl, advice.ctrl = advice.ctrl.msy) \n\nmin.opt <- FLBEIA(biols = biols, SRs = SRs, BDs = NULL, fleets = fleets, covars = list(rec = SRs$HKE@rec),\n                  indices = NULL, advice = advice.opt, main.ctrl = main.ctrl, biols.ctrl = biols.ctrl, fleets.ctrl = fleets.ctrl.min, \n                  covars.ctrl = NULL, obs.ctrl = obs.ctrl, assess.ctrl = assess.ctrl, advice.ctrl = advice.ctrl.msy)\n\npre.opt <- FLBEIA(biols = biols, SRs = SRs, BDs = NULL, fleets = fleets, covars = list(rec = SRs$HKE@rec),\n                  indices = NULL, advice = advice.opt, main.ctrl = main.ctrl, biols.ctrl = biols.ctrl, fleets.ctrl = fleets.ctrl.prev, \n                  covars.ctrl = NULL, obs.ctrl = obs.ctrl, assess.ctrl = assess.ctrl, advice.ctrl = advice.ctrl.msy) \n\n\n\n#-------------------------------------------------------------\n# Summaries\n#-------------------------------------------------------------\n\nbio <- rbind(bioSum(max, scenario = 'max'),  bioSum(min, scenario = 'min'), bioSum(pre, scenario = 'pre'),\n             bioSum(max.the, scenario = 'max.the'),  bioSum(min.the, scenario = 'min.the'), bioSum(pre.the, scenario = 'pre.the'),\n             bioSum(max.opt, scenario = 'max.opt'),  bioSum(min.opt, scenario = 'min.opt'), bioSum(pre.opt, scenario = 'pre.opt'))\n\nflt <- rbind(fltSum(max, scenario = 'max'),  fltSum(min, scenario = 'min'), fltSum(pre, scenario = 'pre'),\n             fltSum(max.the, scenario = 'max.the'),  fltSum(min.the, scenario = 'min.the'), fltSum(pre.the, scenario = 'pre.the'),\n             fltSum(max.opt, scenario = 'max.opt'),  fltSum(min.opt, scenario = 'min.opt'), fltSum(pre.opt, scenario = 'pre.opt'))\n\nfltStk <- rbind(fltStkSum(max, scenario = 'max'),  fltStkSum(min, scenario = 'min'), fltStkSum(pre, scenario = 'pre'),\n                fltStkSum(max.the, scenario = 'max.the'),  fltStkSum(min.the, scenario = 'min.the'), fltStkSum(pre.the, scenario = 'pre.the'),\n                fltStkSum(max.opt, scenario = 'max.opt'),  fltStkSum(min.opt, scenario = 'min.opt'), fltStkSum(pre.opt, scenario = 'pre.opt'))\n\nmt <- rbind(mtSum(max, scenario = 'max'),  mtSum(min, scenario = 'min'), mtSum(pre, scenario = 'pre'),\n            mtSum(max.the, scenario = 'max.the'),  mtSum(min.the, scenario = 'min.the'), mtSum(pre.the, scenario = 'pre.the'),\n            mtSum(max.opt, scenario = 'max.opt'),  mtSum(min.opt, scenario = 'min.opt'), mtSum(pre.opt, scenario = 'pre.opt'))\n\nmtStk <- rbind(mtStkSum(max, scenario = 'max'),  mtStkSum(min, scenario = 'min'), mtStkSum(pre, scenario = 'pre'),\n               mtStkSum(max.the, scenario = 'max.the'),  mtStkSum(min.the, scenario = 'min.the'), mtStkSum(pre.the, scenario = 'pre.the'),\n               mtStkSum(max.opt, scenario = 'max.opt'),  mtStkSum(min.opt, scenario = 'min.opt'), mtStkSum(pre.opt, scenario = 'pre.opt'))\n\nadv <- rbind(advSum(max, scenario = 'max'),  advSum(min, scenario = 'min'), advSum(pre, scenario = 'pre'),\n             advSum(max.the, scenario = 'max.the'),  advSum(min.the, scenario = 'min.the'), advSum(pre.the, scenario = 'pre.the'),\n             advSum(max.opt, scenario = 'max.opt'),  advSum(min.opt, scenario = 'min.opt'), advSum(pre.opt, scenario = 'pre.opt'))\n\nBpa <- Blim <- sapply(biols, function(x) return(0))\nPrflim <- sapply(fleets, function(x) return(0))\n\nrisk <- rbind(riskSum(max, Bpa = Bpa, Blim = Blim, Prflim = Prflim, scenario = 'max'),  \n              riskSum(min, Bpa = Bpa, Blim = Blim, Prflim = Prflim, scenario = 'min'), \n              riskSum(pre, Bpa = Bpa, Blim = Blim, Prflim = Prflim, scenario = 'pre'),\n              riskSum(max.the, Bpa = Bpa, Blim = Blim, Prflim = Prflim, scenario = 'max.the'), \n              riskSum(min.the, Bpa = Bpa, Blim = Blim, Prflim = Prflim, scenario = 'min.the'), \n              riskSum(pre.the, Bpa = Bpa, Blim = Blim, Prflim = Prflim, scenario = 'pre.the'),\n              riskSum(max.opt, Bpa = Bpa, Blim = Blim, Prflim = Prflim, scenario = 'max.opt'),  \n              riskSum(min.opt, Bpa = Bpa, Blim = Blim, Prflim = Prflim, scenario = 'min.opt'), \n              riskSum(pre.opt, Bpa = Bpa, Blim = Blim, Prflim = Prflim, scenario = 'pre.opt'))\n\nsave(bio, flt, risk, adv, fltStk, mt, mtStk, max, max.the, max.opt, min, min.the, min.opt, pre, pre.the, pre.opt, file = './output/results.RData')\n\nbio <- bioSumQ(bio)\nflt <- fltSumQ(flt)\nfltStk <- fltStkSumQ(fltStk)\nmt <- mtSumQ(mt)\nmtStk <- mtStkSumQ(mtStk)\nadv <- advSumQ(adv)\n\nflbeiaApp(bio = bio, flt = flt, adv = adv, fltStk = fltStk, mt = mt, mtStk = mtStk, calculate_npv = FALSE)\n",
    "created" : 1543568662103.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1225456857",
    "id" : "872E9562",
    "lastKnownWriteTime" : 1543579194,
    "last_content_update" : 1543579194,
    "path" : "~/OneDrive - AZTI/BoB/03_Economics/02_Simulations.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 17,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}