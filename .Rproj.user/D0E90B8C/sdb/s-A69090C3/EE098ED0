{
    "collab_server" : "",
    "contents" : "##------------------------------------------------------------------------##\n#  Dorleta Garcia\n#  2018/11/10\n#  \n#  RScript to test the shiny application\n##------------------------------------------------------------------------##\n\n\nrm(list = ls())\n\nlibrary(devtools)\ninstall('c:/use/FLR/FLBEIA/shiny/FLBEIAShiny')\n\n\nlibrary(FLBEIA)\nlibrary(FLBEIAShiny)\n\nload('C:/use/FLR/FLBEIA/shiny/res_shiny.RData' )\n\n\nscnms <- unique(bioQ$scenario)\nstknms <- unique(mtStkQ$stock)\nRefPts <- expand.grid(indicator=c(\"Bmsy\", \"Fmsy\", \"Bpa\", \"Blim\", \"Fpa\", \"Flim\"), scenario=scnms, stock=stknms, value=NA)[,c(3,2,1,4)]\nrp <- c(rep(c(45000, 0.28, 45000, 32000, 0.62, 0.87), length(scnms)),\n        rep(c(41800, 0.191, 41800, 37100, 0.45, 0.53), length(scnms)), \n        rep(c(22278, 0.28, 222278, 16032, 0.36, 0.53), length(scnms)))     \nRefPts[,4] <- rp\n                \n\naa <- subset(fltQ, indicator == 'grossValue')\naa$indicator <- 'grossSurplus'\nfltQ <- rbind(aa, fltQ)         \n\nfltQ[fltQ$indicator == 'grossSurplus', 'q50'] <- runif(length(fltQ[fltQ$indicator == 'grossSurplus', 'indicator']), 9e5,10e7)\nfltQ[fltQ$indicator == 'grossValue', 'q50'] <- runif(length(fltQ[fltQ$indicator == 'grossValue', 'indicator']), 9e6,20e7)\n\nfltQ[fltQ$indicator == 'grossSurplus', 'q05'] <- fltQ[fltQ$indicator == 'grossSurplus', 'q50']*0.75 \nfltQ[fltQ$indicator == 'grossValue', 'q05'] <- fltQ[fltQ$indicator == 'grossSurplus', 'q50']*0.75 \n\nfltQ[fltQ$indicator == 'grossSurplus', 'q95'] <- fltQ[fltQ$indicator == 'grossSurplus', 'q50']*1.25 \nfltQ[fltQ$indicator == 'grossValue', 'q95'] <- fltQ[fltQ$indicator == 'grossSurplus', 'q50']*1.25 \n\n\n# Transform the data to use it as example\nbioQ$stock <- ifelse(bioQ$stock == 'HKE', 'Cod', ifelse(bioQ$stock == 'MON', 'Hake', 'Sole'))\nfltStkQ$stock <- ifelse(fltStkQ$stock == 'HKE', 'Cod', ifelse(fltStkQ$stock == 'MON', 'Hake', 'Sole'))\nadvQ$stock <- ifelse(advQ$stock == 'HKE', 'Cod', ifelse(advQ$stock == 'MON', 'Hake', 'Sole'))\nmtStkQ$stock <- ifelse(mtStkQ$stock == 'HKE', 'Cod', ifelse(mtStkQ$stock == 'MON', 'Hake', 'Sole'))\nRefPts$stock <- ifelse(RefPts$stock == 'HKE', 'Cod', ifelse(RefPts$stock == 'MON', 'Hake', 'Sole'))\nrisk$unit <- ifelse(risk$unit == 'HKE', 'Cod', ifelse(risk$unit == 'MON', 'Hake', ifelse(risk$unit == 'MEG', 'Sole', risk$unit)))\n\nfltStkQ$fleet <- substr(fltStkQ$fleet,1,3)\nmtStkQ$fleet <- substr(mtStkQ$fleet,1,3)\nfltQ$fleet <- substr(fltQ$fleet,1,3)\nmtQ$fleet <- substr(mtQ$fleet,1,3)\nrisk$unit <- ifelse(!(risk$unit %in% c(\"Cod\", \"Sole\", \"Hake\")), substr(risk$unit,1,3), risk$unit)\n\n\nfltStkQ$fleet <- ifelse(fltStkQ$fleet %in% c('HKE', 'MON'),'MIS',fltStkQ$fleet)\nmtStkQ$fleet <- ifelse(mtStkQ$fleet %in% c('HKE', 'MON'),'MIS',mtStkQ$fleet)\nfltQ$fleet <- ifelse(fltQ$fleet %in% c('HKE', 'MON'),'MIS',fltQ$fleet)\nmtQ$fleet <- ifelse(mtQ$fleet %in% c('HKE', 'MON'),'MIS',mtQ$fleet)\nrisk$unit <- ifelse(risk$unit %in% c('HKE', 'MON'),'MIS',risk$unit)\n\nfltQ$fleet    <- ifelse(fltQ$fleet %in% c('OT6', 'OT7', 'OT8'), 'OT8', fltQ$fleet)\nmtQ$fleet     <- ifelse(mtQ$fleet %in% c('OT6', 'OT7', 'OT8'), 'OT8', mtQ$fleet)\nmtStkQ$fleet  <- ifelse(mtStkQ$fleet %in% c('OT6', 'OT7', 'OT8'), 'OT8', mtStkQ$fleet)\nfltStkQ$fleet <- ifelse(fltStkQ$fleet %in% c('OT6', 'OT7', 'OT8'), 'OT8', fltStkQ$fleet)\n\nflt1 <- aggregate(list(q95 = fltQ$q95, q50 = fltQ$q50, q05 = fltQ$q05), \n                 list(fleet = fltQ$fleet, indicator = fltQ$indicator, year = fltQ$year, scenario = fltQ$scenario), sum, na.rm = TRUE)\nflt2 <- aggregate(list(q95 = fltQ$q95, q50 = fltQ$q50, q05 = fltQ$q05), \n                 list(fleet = fltQ$fleet,  indicator = fltQ$indicator, year = fltQ$year, scenario = fltQ$scenario), mean, na.rm = TRUE)\n\nfltQ <- rbind(subset(flt2, indicator %in% c('capacity', 'nVessels', 'discRat', 'price', 'quotaUpt')),\n              subset(flt1, !(indicator %in% c('capacity', 'nVessels', 'discRat', 'price', 'quotaUpt'))))\n\nmt1 <- aggregate(list(q95 = mtQ$q95, q50 = mtQ$q50, q05 = mtQ$q05), \n                  list(fleet = mtQ$fleet, metier = mtQ$metier, indicator = mtQ$indicator, year = mtQ$year, scenario = mtQ$scenario), sum, na.rm = TRUE)\nmt2 <- aggregate(list(q95 = mtQ$q95, q50 = mtQ$q50, q05 = mtQ$q05), \n                  list(fleet = mtQ$fleet, metier = mtQ$metier, indicator = mtQ$indicator, year = mtQ$year, scenario = mtQ$scenario), mean, na.rm = TRUE)\n\nmtQ <- rbind(subset(mt2, indicator %in% c('effort')), subset(mt1, !(indicator %in% c('effort'))))\n\n\nfltStk1 <- aggregate(list(q95 = fltStkQ$q95, q50 = fltStkQ$q50, q05 = fltStkQ$q05), \n                  list(fleet = fltStkQ$fleet, stock = fltStkQ$stock, indicator = fltStkQ$indicator, year = fltStkQ$year, scenario = fltStkQ$scenario), sum, na.rm = TRUE)\nfltStk2 <- aggregate(list(q95 = fltStkQ$q95, q50 = fltStkQ$q50, q05 = fltStkQ$q05), \n                  list(fleet = fltStkQ$fleet, stock = fltStkQ$stock, indicator = fltStkQ$indicator, year = fltStkQ$year, scenario = fltStkQ$scenario), mean, na.rm = TRUE)\n\nfltStkQ <- rbind(subset(fltStk2, indicator %in% c('discRat', 'price', 'quotaUpt')),\n              subset(fltStk1, !(indicator %in% c('discRat', 'price', 'quotaUpt'))))\n\n\nmtStk1 <- aggregate(list(q95 = mtStkQ$q95, q50 = mtStkQ$q50, q05 = mtStkQ$q05), \n                     list(fleet = mtStkQ$fleet, metier = mtStkQ$metier, stock = mtStkQ$stock, indicator = mtStkQ$indicator, year = mtStkQ$year, scenario = mtStkQ$scenario), sum, na.rm = TRUE)\nmtStk2 <- aggregate(list(q95 = mtStkQ$q95, q50 = mtStkQ$q50, q05 = mtStkQ$q05), \n                     list(fleet = mtStkQ$fleet, metier = mtStkQ$metier, stock = mtStkQ$stock, indicator = mtStkQ$indicator, year = mtStkQ$year, scenario = mtStkQ$scenario), mean, na.rm = TRUE)\n\nmtStkQ <- rbind(subset(mtStk2, indicator %in% c('discRat', 'price')),\n                 subset(mtStk1, !(indicator %in% c('discRat', 'price'))))\n\nrisk <- aggregate(value ~ year + unit + scenario +  indicator, risk, mean, na.rm = TRUE)\n\n\nsave(RefPts, bioQ, fltQ, advQ, fltStkQ, mtQ, mtStkQ, risk, file = 'c:/use/FLR/FLBEIA/shiny/FLBEIAShiny/data/FLBEIAShiny.RData')\n\nflbeiaApp(RefPts=RefPts,bio = bioQ, flt = fltQ, adv = advQ, \n          fltStk = fltStkQ, mt = mtQ, mtStk = mtStkQ, risk = risk,\n          years = as.character(2010:2024), \n          calculate_npv = FALSE, npv =  NULL, npv.y0 = NULL, npv.yrs = NULL) \n\n",
    "created" : 1542285570762.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2380250082",
    "id" : "EE098ED0",
    "lastKnownWriteTime" : 1542285776,
    "last_content_update" : 1542285776462,
    "path" : "~/FLR/FLBEIA/shiny/Testing Shiny.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 16,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}