{
    "collab_server" : "",
    "contents" : "#----------------------------------------------------\n# Dorleta Garc?a\n# 2018/09/18\n#----------------------------------------------------\nsetwd('C:/use/OneDrive - AZTI/BoB')\n\nlibrary(ggplot2)\n\n\n\nload('./output/res_sums.RData')\nload('./data/ctrls.RData')\n\n# Reference points\nscnms <- unique(BIO$scenario)\nstknms <- c(unique(BIO$stock))\nRefPts <- expand.grid(indicator=c(\"Bmsy\", \"Fmsy\", \"Bpa\", \"Blim\", \"Fpa\", \"Flim\", \"Flow\", \"Fupp\"), scenario=scnms, stock=stknms[1:3], value=NA)[,c(3,2,1,4)]\nrp <- c( rep(c(45000, 0.28, 45000, 32000, 0.62, 0.87, 0.18,0.45), length(scnms)),\n        rep(c(41800, 0.191, 41800, 37100, 0.45, 0.53, 0.102, 0.289), length(scnms)), \n        rep(c(22278, 0.28, 222278, 16032, 0.36, 0.53, 0.181, 0.39), length(scnms)))     \nRefPts[,4] <- rp\n\n\n# Color palette.\ngg_color_hue <- function(n) {\n  hues = seq(15, 375, length = n + 1)\n  hcl(h = hues, l = 65, c = 100)[1:n]\n}\n\nn    <- 4\ncols <- gg_color_hue(n)\n\n\na1 <- aggregate(q50 ~ stock + indicator + year + scenario, BIO, quantile, c(0.05,0.5,0.95))\nBIO <- cbind(a1[,1:4], q05 = a1[,5][,1], q50 = a1[,5][,2], q95 = a1[,5][,3])\n\na1 <- aggregate(q50 ~ stock + indicator + year + scenario, ADV, quantile, c(0.05,0.5,0.95))\nADV <- cbind(a1[,1:4], q05 = a1[,5][,1], q50 = a1[,5][,2], q95 = a1[,5][,3])\n\na1 <- aggregate(q50 ~ fleet + stock + indicator + year + scenario, FLTSTK, quantile, c(0.05,0.5,0.95))\nFLTSTK <- cbind(a1[,1:5], q05 = a1[,6][,1], q50 = a1[,6][,2], q95 = a1[,6][,3])\n\n\nBIO$scenario <- ifelse(BIO$scenario =='max', 'SSHCR_BaU', ifelse(BIO$scenario == 'min', 'SSHCR_LO',\n                    ifelse(BIO$scenario == 'max.max', 'MSHCRmax_BaU', ifelse(BIO$scenario == 'max.min', 'MSHCRmax_LO',\n                       ifelse(BIO$scenario == 'min.max', 'MSHCRmin_BaU', ifelse(BIO$scenario == 'min.min', 'MSHCRmin_LO',\n                          ifelse(BIO$scenario == 'mean.max', 'MSHCRmean_BaU', ifelse(BIO$scenario == 'mean.min', 'MSHCRmean_LO',\n                               BIO$scenario))))))))\n\nADV$scenario <- ifelse(ADV$scenario =='max', 'SSHCR_BaU', ifelse(ADV$scenario == 'min', 'SSHCR_LO',\n               ifelse(ADV$scenario == 'max.max', 'MSHCRmax_BaU', ifelse(ADV$scenario == 'max.min', 'MSHCRmax_LO',\n              ifelse(ADV$scenario == 'min.max', 'MSHCRmin_BaU', ifelse(ADV$scenario == 'min.min', 'MSHCRmin_LO',\n             ifelse(ADV$scenario == 'mean.max', 'MSHCRmean_BaU', ifelse(ADV$scenario == 'mean.min', 'MSHCRmean_LO',\n          ADV$scenario))))))))\n\nFLTSTK$scenario <- ifelse(FLTSTK$scenario =='max', 'SSHCR_BaU', ifelse(FLTSTK$scenario == 'min', 'SSHCR_LO',\n                    ifelse(FLTSTK$scenario == 'max.max', 'MSHCRmax_BaU', ifelse(FLTSTK$scenario == 'max.min', 'MSHCRmax_LO',\n                        ifelse(FLTSTK$scenario == 'min.max', 'MSHCRmin_BaU', ifelse(FLTSTK$scenario == 'min.min', 'MSHCRmin_LO',\n                            ifelse(FLTSTK$scenario == 'mean.max', 'MSHCRmean_BaU', ifelse(FLTSTK$scenario == 'mean.min', 'MSHCRmean_LO',\n                  FLTSTK$scenario))))))))                                                                                                                                                                                                             \n\nRefPts$scenario <- ifelse(RefPts$scenario =='max', 'SSHCR_BaU', ifelse(RefPts$scenario == 'min', 'SSHCR_LO',\n                       ifelse(RefPts$scenario == 'max.max', 'MSHCRmax_BaU', ifelse(RefPts$scenario == 'max.min', 'MSHCRmax_LO',\n                            ifelse(RefPts$scenario == 'min.max', 'MSHCRmin_BaU', ifelse(RefPts$scenario == 'min.min', 'MSHCRmin_LO',\n                                 ifelse(RefPts$scenario == 'mean.max', 'MSHCRmean_BaU', ifelse(RefPts$scenario == 'mean.min', 'MSHCRmean_LO',\n                                                                                               RefPts$scenario))))))))                                                                                                                                                                                                        \n\n#--------------------------------------------------------------------------------------------------------------------\n#------------------------------- FISHING MORTALITY-------------------------------------------------------------------\n#--------------------------------------------------------------------------------------------------------------------\nBIO <- cbind(BIO, management = ifelse(BIO$scenario %in%  c(\"MSHCRmax_LO\",  \"MSHCRmean_LO\", \"SSHCR_LO\", \"MSHCRmin_LO\"), 'LO', 'BaU'))\nBIO <- cbind(BIO, HCR = ifelse(BIO$scenario %in% c(\"fef\", \"SSHCR_BaU\", \"SSHCR_LO\",  \"pre\"), 'IcesHCR',\n                          ifelse(BIO$scenario %in% c(\"MSHCRmax_BaU\", \"MSHCRmax_LO\"), 'MSHCRmax',     \n                            ifelse(BIO$scenario %in% c(\"MSHCRmean_BaU\", \"MSHCRmean_LO\"), 'MSHCRmean', 'min')))) \n\nADV <- cbind(ADV, management = ifelse(ADV$scenario %in%  c(\"MSHCRmax_LO\",  \"MSHCRmean_LO\", \"SSHCR_LO\", \"MSHCRmin_LO\"), 'LO', 'BaU'))\nADV <- cbind(ADV, HCR = ifelse(ADV$scenario %in% c(\"fef\", \"SSHCR_BaU\", \"SSHCR_LO\",  \"pre\"), 'IcesHCR',\n                               ifelse(ADV$scenario %in% c(\"MSHCRmax_BaU\", \"MSHCRmax_LO\"), 'MSHCRmax',     \n                                      ifelse(ADV$scenario %in% c(\"MSHCRmean_BaU\", \"MSHCRmean_LO\"), 'MSHCRmean', 'min')))) \n\nFLTSTK <- cbind(FLTSTK, management = ifelse(FLTSTK$scenario %in%  c(\"MSHCRmax_LO\",  \"MSHCRmean_LO\", \"SSHCR_LO\", \"MSHCRmin_LO\"), 'LO', 'BaU'))\nFLTSTK <- cbind(FLTSTK, HCR = ifelse(FLTSTK$scenario %in% c(\"fef\", \"SSHCR_BaU\", \"SSHCR_LO\",  \"pre\"), 'IcesHCR',\n                               ifelse(FLTSTK$scenario %in% c(\"MSHCRmax_BaU\", \"MSHCRmax_LO\"), 'MSHCRmax',     \n                                      ifelse(FLTSTK$scenario %in% c(\"MSHCRmean_BaU\", \"MSHCRmean_LO\"), 'MSHCRmean', 'min')))) \n\n\nRefPts <- cbind(RefPts, management = ifelse(RefPts$scenario %in%  c(\"MSHCRmax_LO\",  \"MSHCRmean_LO\", \"SSHCR_LO\", \"MSHCRmin_LO\"), 'LO', 'BaU'))\nRefPts <- cbind(RefPts, HCR = ifelse(RefPts$scenario %in% c(\"fef\", \"SSHCR_BaU\", \"SSHCR_LO\",  \"pre\"), 'IcesHCR',\n                               ifelse(RefPts$scenario %in% c(\"MSHCRmax_BaU\", \"MSHCRmax_LO\"), 'MSHCRmax',     \n                                      ifelse(RefPts$scenario %in% c(\"MSHCRmean_BaU\", \"MSHCRmean_LO\"), 'MSHCRmean', 'min')))) \n\n\nADV$HCR  <- as.character(ADV$HCR)\nBIO$HCR  <- as.character(BIO$HCR)\nFLTSTK$HCR  <- as.character(FLTSTK$HCR)\n\n#------------- Fishing mortality -------------------------------------------------------------\nBIO$HCR <- ifelse(BIO$HCR == 'min', 'MSHCRmin', BIO$HCR)\nBIO$HCR <- ifelse(BIO$HCR == 'IcesHCR', 'SSHCR', BIO$HCR)\nBIO$year <- as.integer(BIO$year)\nggplot(subset(BIO, indicator == 'f' & year > 2014 & !(scenario %in% c('fef', 'pre', 'min.pre', 'max.pre', 'mean.pre'))), aes(year,q50, color = HCR)) + \n  geom_line(lwd = 1.5) +\n  theme(text = element_text(size=10), axis.title =element_blank(), legend.spacing.y = unit(.08, \"inches\")) + \n  ggtitle('Fishing Mortality') +\n  facet_grid(management~stock) + \n  scale_x_continuous(breaks = c(2015,2018, 2021,2024)) +\n  scale_color_manual(values= cols[c(2,4,3,1)])+ \n  geom_vline(xintercept = 2018, lty = 2, col = 'grey') +\n  geom_hline(aes(yintercept = value, lty = indicator), \n             color =1,data = subset(RefPts, stock != 'ANK' & !(scenario %in% c('fef', 'pre', 'min.pre', 'max.pre', 'mean.pre')) & indicator %in% c('Flow', 'Fmsy', 'Fupp')))\nggsave('./plots/F_Fleets.png', width = 7, height = 4)\n\n\n# What happens at fleet level??\n\n\n\n\n\n#------------- SSB -------------------------------------------------------------\n\nggplot(subset(BIO, indicator == 'ssb' & year > 2014 & !(scenario %in% c('fef', 'pre', 'min.pre', 'max.pre', 'mean.pre'))), aes(year,q50, color = HCR)) + \n  geom_line(lwd = 1.5) + geom_ribbon(aes(ymin = q05, ymax = q95, fill = HCR), alpha = 0.4) + \n  theme(text = element_text(size=10), axis.title =element_blank(), legend.spacing.y = unit(.08, \"inches\")) + \n  ggtitle('Fishing Mortality') +\n  facet_grid(stock~management, scales = 'free') + \n  scale_color_manual(values= cols)+ \n  geom_hline(aes(yintercept = value, lty = indicator), color =1,data = subset(RefPts, stock != 'ANK'  & indicator %in% c('Bpa', 'Blim')))\nggsave('./plots/SSB_Fleets.png', width = 7, height = 2.5 )\n\n\n#----------- Quanto Uptake and landings ------------------------------------------------------------- \n#------------  All scenarios together ---------------------------------------------------------------\n\ndat <- subset(ADV, indicator == 'quotaUpt' & year == 2025 &\n                scenario %in% c('SSHCR_BaU', 'MSHCRmax_BaU', 'MSHCRmean_BaU', 'MSHCRmin_BaU', \n                                'SSHCR_LO', 'MSHCRmax_LO', 'MSHCRmean_LO', 'MSHCRmin_LO'))\ndat$HCR <- ifelse(dat$HCR == 'min', 'MSHCRmin', dat$HCR)\n\nggplot(dat, aes(HCR, q50)) + \n  geom_bar(stat = 'identity', aes(fill = HCR)) +\n  theme(text = element_text(size=10), axis.title =element_blank(), legend.spacing.y = unit(.08, \"inches\")) + \n  ggtitle('Quota Uptake') +\n  facet_grid(stock ~ management) + scale_color_manual(values= cols) +\n  geom_hline(yintercept = 1) +   \n  theme(axis.title.x=element_blank(),\n        axis.text.x=element_blank(),\n        axis.ticks.x=element_blank())\nggsave('./plots/Quota Uptake_Bars_Fleets.png', width = 4, height = 4 )\n\n\ndat <- subset(ADV, indicator == 'landings' & year == 2025 &\n                scenario %in% c('SSHCR_BaU', 'MSHCRmax_BaU', 'MSHCRmean_BaU', 'MSHCRmin_BaU', \n                                'SSHCR_LO', 'MSHCRmax_LO', 'MSHCRmean_LO', 'MSHCRmin_LO'))\ndat$HCR <- ifelse(dat$HCR == 'min', 'MSHCRmin', dat$HCR)\n\nggplot(dat, aes(HCR, q50)) + \n  geom_bar(stat = 'identity', aes(fill = HCR)) +\n  theme(text = element_text(size=10), axis.title =element_blank(), legend.spacing.y = unit(.08, \"inches\")) + \n  ggtitle('Landings') +\n  facet_grid(stock ~ management, scales = \"free_y\") + scale_color_manual(values= cols) +\n  theme(axis.title.x=element_blank(),\n        axis.text.x=element_blank(),\n        axis.ticks.x=element_blank())\nggsave('./plots/Landings_Bars_Fleets.png', width = 4, height = 4 )\n\n\n\ndat <- subset(ADV, indicator %in% c('landings', 'discards') & year == 2025 &\n                scenario %in% c('SSHCR_BaU', 'MSHCRmax_BaU', 'MSHCRmean_BaU', 'MSHCRmin_BaU', \n                                'SSHCR_LO', 'MSHCRmax_LO', 'MSHCRmean_LO', 'MSHCRmin_LO'))\ndat$HCR <- ifelse(dat$HCR == 'min', 'MSHCRmin', dat$HCR)\n\nggplot(dat, aes(HCR, q50)) + \n  geom_bar(stat = 'identity', aes(fill = indicator)) +\n  theme(text = element_text(size=10), axis.title =element_blank(), legend.spacing.y = unit(.08, \"inches\")) + \n  ggtitle('Landings') +\n  facet_grid(stock ~ management, scales = \"free_y\") + scale_color_manual(values= cols) +\n  theme(axis.title.x=element_blank(),\n        axis.text.x=element_blank(),\n        axis.ticks.x=element_blank())\nggsave('./plots/Landings_Bars_Fleets.png', width = 4, height = 4 )\n\n\n#--------------------------\n\n\nfor(fl in unique(FLTSTK$fleet)){\n  dat <- subset(FLTSTK, indicator == 'landings' & year == 2025 &\n                scenario %in% c('SSHCR_BaU', 'MSHCRmax_BaU', 'MSHCRmean_BaU', 'MSHCRmin_BaU', \n                                'SSHCR_LO', 'MSHCRmax_LO', 'MSHCRmean_LO', 'MSHCRmin_LO') &\n              fleet == fl)\n  dat$HCR <- ifelse(dat$HCR == 'min', 'MSHCRmin', dat$HCR)\n\n  ggplot(dat, aes(HCR, q50)) + \n    geom_bar(stat = 'identity', aes(fill = HCR)) +\n    theme(text = element_text(size=10), axis.title =element_blank(), legend.spacing.y = unit(.08, \"inches\")) + \n    ggtitle(paste('Landings :: ', fl, sep = \"\")) +\n    facet_grid(stock ~ management, scales = \"free_y\") + scale_color_manual(values= cols) +\n    theme(axis.title.x=element_blank(),\n        axis.text.x=element_blank(),\n        axis.ticks.x=element_blank()) \n  ggsave(paste('./plots/Landings_Bars_',fl, '.png',sep=\"\"), width = 4, height = 4 )\n\n\n   dat <- subset(FLTSTK, indicator == 'quotaUpt' & year == 2025 &\n                scenario %in% c('SSHCR_BaU', 'MSHCRmax_BaU', 'MSHCRmean_BaU', 'MSHCRmin_BaU', \n                                'SSHCR_LO', 'MSHCRmax_LO', 'MSHCRmean_LO', 'MSHCRmin_LO') &\n                fleet == fl)\n  dat$HCR <- ifelse(dat$HCR == 'min', 'MSHCRmin', dat$HCR)\n\n ggplot(dat, aes(HCR, q50)) + \n  geom_bar(stat = 'identity', aes(fill = HCR)) +\n  theme(text = element_text(size=10), axis.title =element_blank(), legend.spacing.y = unit(.08, \"inches\")) + \n  ggtitle(paste('quotaUpt :: ',fl, sep=\"\" )) +\n  facet_grid(stock ~ management, scales = \"free_y\") + scale_color_manual(values= cols) +\n  theme(axis.title.x=element_blank(),\n        axis.text.x=element_blank(),\n        axis.ticks.x=element_blank()) + \n  geom_hline(yintercept = 1)\n ggsave(paste('./plots/QuotaUpt_Bars_',fl, '.png',sep=\"\"), width = 4, height = 4 )\n \n}",
    "created" : 1542120091503.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "967012763",
    "id" : "29CFA66C",
    "lastKnownWriteTime" : 1537827709,
    "last_content_update" : 1537827709,
    "path" : "~/OneDrive - AZTI/BoB/01_MultiStockHCR/05_BoB_Analysis_Sims.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 12,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}